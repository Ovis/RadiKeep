@using RadiKeep.Logics.Models.Enums
@using RadiKeep.Logics.Primitives.DataAnnotations

@{
    ViewData["Title"] = "ラジオ番組検索";
}

<section class="section">
    <div class="rk-page-head">
        <h1 class="rk-page-title">ラジオ番組検索</h1>
        <p class="rk-page-subtitle">条件を指定して番組を検索し、そのまま予約できます。</p>
    </div>

    <div class="rk-panel mb-6">
        <div id="searchInformationElm" class="space-y-5">
            <div class="rk-search-grid">
                <div class="rk-search-card">
                    <h2 class="rk-search-card-title">検索キーワード</h2>
                    <div class="field">
                        <label class="label" for="Keyword">キーワード</label>
                        <div class="control">
                            <input class="input" type="text" id="Keyword" name="Keyword" placeholder="番組名・出演者名など" />
                        </div>
                        <label class="rk-check-inline">
                            <input type="checkbox" id="SearchTitleOnly" name="SearchTitleOnly" value="true" />
                            タイトルのみを検索
                        </label>
                    </div>
                    <div class="field">
                        <label class="label" for="ExcludedKeyword">除外キーワード</label>
                        <div class="control">
                            <input class="input" type="text" id="ExcludedKeyword" name="ExcludedKeyword" placeholder="除外したい単語" />
                        </div>
                        <label class="rk-check-inline">
                            <input type="checkbox" id="ExcludeTitleOnly" name="ExcludeTitleOnly" value="true" />
                            タイトルのみを除外
                        </label>
                    </div>
                    <div class="field">
                        <label class="label" for="KeywordReserveOrderKind">並び順</label>
                        <div class="select">
                            <select id="KeywordReserveOrderKind" name="KeywordReserveOrderKind">
                                @foreach (KeywordReserveOrderKind kind in Enum.GetValues(typeof(KeywordReserveOrderKind)))
                                {
                                    <option value="@kind">@kind.GetEnumDisplayName()</option>
                                }
                            </select>
                        </div>
                    </div>
                </div>

                <div class="rk-search-card">
                    <h2 class="rk-search-card-title">放送時間・抽出条件</h2>
                    <div class="field">
                        <label class="label">開始・終了時刻</label>
                        <div class="control">
                            <div class="flex items-center gap-3">
                                <input class="input flex-1 min-w-0" type="time" id="StartTime" value="00:00">
                                <input class="input flex-1 min-w-0" type="time" id="EndTime" value="23:59">
                            </div>
                        </div>
                    </div>
                    <div class="field">
                        <label class="rk-check-inline">
                            <input type="checkbox" id="IncludeHistoricalPrograms" name="IncludeHistoricalPrograms" value="false" />
                            放送済みの番組も含める
                        </label>
                    </div>
                    <div class="field mt-3">
                        <label class="label">曜日</label>
                        <div class="rk-days-grid">
                            @foreach (DaysOfWeek day in Enum.GetValues(typeof(DaysOfWeek)))
                            {
                                if (day != DaysOfWeek.None)
                                {
                                    <label class="rk-day-chip">
                                        <input type="checkbox" id="day-@day" name="SelectedDaysOfWeek" value="@((int)day)" checked />
                                        <span>@day.GetEnumDisplayName()</span>
                                    </label>
                                }
                            }
                        </div>
                    </div>
                </div>
            </div>

            <div class="rk-search-card">
                <h2 class="rk-search-card-title">放送局</h2>
                <div class="control">
                    <div id="radikoStationGroups" class="pt-2">
                    </div>

                    <div id="radiruStationGroups" class="pt-2">
                    </div>
                </div>
            </div>

            <div id="option" class="field">
            </div>
        </div>
    </div>

    <div class="field" id="button">
        <div class="control buttons rk-search-actions">
            <button id="searchButton" class="button is-primary">検索</button>
            <button id="recordingButton" class="button is-success">自動予約ルールを追加</button>
        </div>
    </div>

    <div id="searchResult" class="mt-6 rk-program-grid"></div>
    <div id="searchResultEmpty" class="box p-6 text-center text-zinc-500 hidden mt-4">
        該当する番組が見つかりませんでした。
    </div>
</section>

<template id="search-program-card-template">
    <div class="rk-program-card">
        <div class="card">
            <div class="card-content">
                <div class="flex items-start justify-between gap-2">
                    <p class="title text-lg"></p>
                    <span class="rk-status-badge status-badge hidden"></span>
                </div>
                <p class="subtitle text-sm text-zinc-600"></p>
                <p class="performer text-xs text-zinc-500"></p>
                <div class="content mt-3">
                    <p class="startTime text-xs text-zinc-500"></p>
                    <p class="endTime text-xs text-zinc-500"></p>
                    <p class="description mt-2"></p>
                    <button type="button" class="description-toggle hidden">more</button>
                </div>
            </div>
            <footer class="card-footer">
                <button type="button" class="card-footer-item record-btn">リアルタイム録音</button>
                <button type="button" class="card-footer-item timefree-btn">タイムフリー録音</button>
                <button type="button" class="card-footer-item ondemand-btn hidden">聞き逃し配信録音</button>
            </footer>
        </div>
    </div>
</template>

<!-- モーダル -->
<div id="recordingModal" class="modal">
    <div class="modal-background modal-closeProcess"></div>
    <div class="modal-content">
        <div class="box">
            <p id="modalMessage"></p>
            <button class="button is-primary modal-closeProcess">閉じる</button>
        </div>
    </div>
    <button class="modal-close is-large modal-closeProcess" aria-label="close"></button>
</div>

<div class="rk-toast" id="search-result-toast" role="status" aria-live="polite" aria-atomic="true">
    <div class="rk-toast-body">
        <span id="search-result-toast-message">録音予約を開始しました。</span>
        <button class="delete" aria-label="close" id="search-result-toast-close"></button>
    </div>
</div>

@section Scripts {
    <script type="module" src="~/js/search.js" asp-append-version="true"></script>
}
